<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farmer Masterlist</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="CSS/home.css">
</head>
<body>
    <div class="container">
        <div class="header-wrapper">
            <div class="logo-section">
                <div class="logo-img">
                    <img src="pic/nfa.png" alt="NFA Logo">
                </div>
                <span class="logo-text">FARMER MASTERLIST</span>
            </div>

            <div class="header">
                <nav class="nav">
                    <button class="nav-item active" onclick="showPage('home')">Home</button>
                    <button class="nav-item" onclick="showPage('masterlist')">Masterlist</button>
                </nav>
            </div>

            <div class="user-section">
                <div class="user-dropdown" id="userDropdown" onclick="toggleDropdown()">
                    <span id="userRoleDisplay">ADMIN</span>
                    <span class="dropdown-arrow">▼</span>
                </div>
                <!-- Guest Login Button (will be shown only in guest mode) -->
                <button class="guest-login-btn" id="guestLoginBtn" style="display: none;" onclick="guestLogin()">
                    Login
                </button>
                <div class="dropdown-menu" id="dropdownMenu">
                    <button class="dropdown-item" onclick="logout()">
                        <span>Logout</span>
                    </button>
                </div>
            </div>
        </div>

        <div id="homePage">
            <div class="welcome-banner">
                <div class="welcome-text">
                    <h1>Welcome, Admin!</h1>
                    <p>Have a nice day!</p>
                </div>
            </div>

            <div class="main-grid">
                <div class="left-section">
                    <div class="stats-row">
                        <div class="stat-card">
                            <div class="stat-header">Total Farmers</div>
                            <div class="stat-number" id="totalFarmers">0</div>
                            <div class="stat-label">Registered farmers</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">Registered This Month</div>
                            <div class="stat-number" id="thisMonth">0</div>
                            <div class="stat-label">New farmers this month</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">Registered This Year</div>
                            <div class="stat-number" id="thisYear">0</div>
                            <div class="stat-label">New farmers this year</div>
                        </div>
                    </div>

                    <div class="charts-row">
                        <div class="chart-card">
                            <h3>Gender Distribution</h3>
                            <canvas id="genderChart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>Province</h3>
                            <canvas id="locationChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="recent-card">
                    <h3>Recent Registrations</h3>
                    <div id="activityList">
                        <p style="color: #999; text-align: center; padding: 20px;">Loading...</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="masterlistPage" class="hidden">
            <h1 class="page-title">Farmer Masterlist</h1>
            
            <div class="masterlist-controls">
                <input 
                    type="text" 
                    class="search-bar" 
                    id="searchBar" 
                    placeholder="Search farmers..."
                    onkeyup="searchFarmers()"
                >
                <div class="controls-right">
                    <select class="sort-select" id="sortSelect" onchange="sortTable()">
                        <option value="alphabetical" selected>Alphabetical (A-Z)</option>
                        <option value="latest">Latest</option>
                        <option value="oldest">Oldest</option>
                    </select>
                    <button class="print-btn-main" onclick="window.location.href='print.html'">Print</button>
                    <button class="import-btn" onclick="window.location.href='import.html'">Import Excel</button>
                    <button class="add-btn" onclick="openModal()">+ Add Farmer</button>
                </div>
            </div>

            <div class="table-container">
                <table id="farmerTable">
                    <thead>
                        <tr>
                            <th>Surname</th>
                            <th>Firstname</th>
                            <th>Middle Name</th>
                            <th>Address Line 1</th>
                            <th>Address Line 2</th>
                            <th>Address Line 3</th>
                            <th>Farm Location</th>
                            <th>Birthdate</th>
                            <th>Gender</th>
                            <th>Civil Status</th>
                            <th>Farm Area</th>
                            <th>RSBSA Number</th>
                            <th>Contact</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="farmerTableBody">
                        <tr><td colspan="14" style="text-align: center; padding: 40px;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>


    <div class="modal" id="farmerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Add Farmer</h2>
                <button class="close-btn" onclick="closeModal()">×</button>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Surname *</label>
                    <input type="text" class="form-input" id="surname" required pattern="[A-Za-z\s]+" title="Surname must contain only letters">
                </div>
                <div class="form-group">
                    <label class="form-label">Name *</label>
                    <input type="text" class="form-input" id="name" required pattern="[A-Za-z\s]+" title="Name must contain only letters">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Middle Name</label>
                <input type="text" class="form-input" id="middleName" pattern="[A-Za-z\s]+" title="Middle name must contain only letters">
            </div>
            <div class="form-group">
                <label class="form-label">Address Line 1</label>
                <input type="text" class="form-input" id="address1" required>
            </div>
            <div class="form-group">
                <label class="form-label">Address Line 2</label>
                <input type="text" class="form-input" id="address2">
            </div>
            <div class="form-group">
                <label class="form-label">Address Line 3 (Province)</label>
                <input type="text" class="form-input" id="address3">
            </div>
            <div class="form-group">
                <label class="form-label">Farm Location</label>
                <input type="text" class="form-input" id="farmLocation" required>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Birthdate</label>
                    <input type="date" class="form-input" id="birthdate" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Gender</label>
                    <select class="form-input" id="gender" required>
                        <option value="">Select</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Civil Status</label>
                    <select class="form-input" id="civilStatus" required>
                        <option value="">Select</option>
                        <option value="Single">Single</option>
                        <option value="Married">Married</option>
                        <option value="Widowed">Widowed</option>
                        <option value="Separated">Separated</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Verified Farm Area (hectares)</label>
                    <input type="number" class="form-input" id="farmArea" step="0.01" required>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">RSBSA Number</label>
                <input type="text" class="form-input" id="rsbsaNumber" required>
            </div>
            <div class="form-group">
                <label class="form-label">Contact Number</label>
                <input type="text" class="form-input" id="contactNumber" required pattern="[0-9]{11}" maxlength="11" title="Contact number must be exactly 11 digits">
            </div>
            <button class="submit-btn" onclick="saveFarmer()">Save Farmer</button>
        </div>
    </div>

    <!-- Notification Modal -->
    <div class="notification-modal" id="notificationModal">
        <div class="notification-content">
            <div class="notification-icon" id="notificationIcon">✓</div>
            <h3 class="notification-title" id="notificationTitle">Success</h3>
            <p class="notification-message" id="notificationMessage">Operation completed successfully!</p>
            <button class="notification-btn" onclick="closeNotification()">OK</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="JS/home.js"></script>
    <script src="JS/guest-mode.js"></script>
</body>
</html>